<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="http://localhost:6070/4.4/esri/css/main.css">
    <script src="http://localhost:6070/4.4/init.js"></script>
    <title>ArcGIS JS App</title>
</head>

<body>
    <select id="lstservices"></select>
    <div id="mapview" style="width: 700px; height:700px;"> map here</div>
    <div id="attrlayer"></div>
    <script>
        let map1;
        let mapview;
        require(["esri/Map", "esri/views/MapView", "esri/request", "esri/layers/MapImageLayer", "dojo/domReady!"],
            function(Map, MapView, Request, MapImageLayer) {
                map1 = new Map({
                    basemap: "topo",
                });
                mapview = new MapView({
                    container: "mapview",
                    map: map1,
                    center: [43.944454193102594, 26.34342198397981],
                    zoom: 15
                });

                let URL = "http://localhost:6080/arcgis/rest/services?f=json";
                let requestOptions = {
                    responseType: "json"
                };
                Request(URL, requestOptions).then(function(response) {
                    let result = response.data;
                    let lstservice = document.getElementById("lstservices");

                    lstservice.addEventListener("change", function() {
                        let selectService = lstservice.options[lstservice.selectedIndex].textContent;
                        let layer = new MapImageLayer({
                            url: "http://localhost:6080/arcgis/rest/services/" + selectService + "/MapServer"
                        });
                        map1.removeAll();
                        map1.add(layer);
                        layer.then(function() {
                            mapview.goTo(layer.fullExtent);
                            //populate my Layers
                            let attrlayers = document.getElementById("attrlayer");
                            for (let i = 0; i < layer.sublayers.length; i++) {
                                let sublayer = layer.sublayers.items[i];
                                let input = document.createElement("input");
                                input.type = "checkbox";
                                input.value = sublayer.id;
                                input.checked = sublayer.visible;
                                input.addEventListener("click", function(e) {
                                    let clikedLayer = layer.findSublayerById(Number(e.target.value))
                                    clikedLayer.visible = e.target.checked
                                });
                                let lbl = document.createElement("label");
                                lbl.textContent = sublayer.title;
                                attrlayers.appendChild(input);
                                attrlayers.appendChild(lbl);
                            }
                        });
                    })

                    for (let i = 0; i < result.services.length; i++) {
                        let options = document.createElement("option");
                        options.textContent = result.services[i].name;
                        lstservice.appendChild(options);
                    }
                });
            });
    </script>

</body>

</html>ss